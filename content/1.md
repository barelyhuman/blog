+++
title = "Debugging Electron with VSCode"
date = "2016-09-18T15:27:00-08:00"
+++

Here is a guide to debugging Electron's Main and Renderer Process on all platforms.

I'll be using [electron/electron-quick-start](https://github.com/electron/electron-quick-start). Clone and open the project in VSCode. Then go to the Debug Viewlet and click the configure icon to make an empty `launch.json`.

## Main Process

Fill `launch.json` with the following.

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Main Process",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceRoot}",
      "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron",
      // Use the following for Windows
      // "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron.cmd",
      "program": "${workspaceRoot}/main.js"
    }
  ]
}
```

The setting is pretty self-explanatory, use the `electron` in `node_modules` to run `main.js`. If you go to the Debug Viewlet and run `Debug Main Process`, you should see the code stopping at the breakpoints in `main.js`.

![main process](/img/1/main_process.png)

## Renderer Process

Making Renderer process work involves more effort, but as most of the app lives in Renderer Process, it is of more interest.

First, a high-level explanation as to how we'll make it work. Electron has a launch flag `--remote-debugging-port`, which lets you specify a port for remote debugging. The language spoken at this port is [Chrome Debugging Protocol](https://developer.chrome.com/devtools/docs/debugger-protocol), and VSCode has an extension that just handles that: [Debugger for Chrome](https://marketplace.visualstudio.com/items/msjsdiag.debugger-for-chrome).

### Setting up

#### Go to `main.js` and comment out this line:

```js
mainWindow.webContents.openDevTools()
```
Remote debugging doesn't work well with multiple DevTools open. We'll use the debugger in VSCode instead of Electron's DevTools.

#### Install Debugger for Chrome

Launch Quick Open, and enter `ext install debugger-for-chrome`.

#### Add a new configuration in `launch.json`

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Renderer Process",
      "type": "chrome",
      "request": "launch",
      "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron",
      // Use the following for Windows
      // "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron.cmd",
      "runtimeArgs": [
        "${workspaceRoot}/main.js",
        "--remote-debugging-port=9222"
      ],
      "webRoot": "${workspaceRoot}"
    }
  ]
}
```

Most of the configuration is straightforward. 9222 is the port Debugger for Chrome uses by default, and `webRoot` tells Debugger for Chrome the location of the source code that we want to debug for.

#### Add some code to `renderer.js`

```js
console.log('hello world!')

document.body.addEventListener('click', () => {
  console.log('hello vscode!')
})
```

Now we are ready to go.

### Debugging

I added two breakpoints in `renderer.js`, and ran `Debug Renderer Process` in the Debug Viewlet.

![renderer process](/img/1/renderer_process.png)

Electron will stop on the second breakpoint if I click anywhere in the window:

![renderer process click](/img/1/renderer_process_click.png)

However, it wouldn't hit the first breakpoint. The reason is Debugger for Chrome would first launch Electron, and try to attach to the running process to debug it. When it successfully attached itself, the first `console.log` had already been executed.

The solution is to go to the Electron window and press `cmd+r` to reload, Electron will re-execute the renderer and hit the breakpoint.

![renderer process refresh](/img/1/renderer_process_refresh.png)

### Transpiling

Most modern Web apps are written in ES6 or Typescript, and transpiled to JavaScript. If sourcemaps are generated during transpilation, we can debug the original code in VSCode.

I modified [electron/electron-quick-start](https://github.com/electron/electron-quick-start) to use Babel and Webpack to transpile ES6 code. Here I'm debugging the un-transpiled code:

![es6 debug](/img/1/es6_debug.png)

Details are in this commit: [4bb4a93](https://github.com/octref/vscode-electron-debug/commit/4bb4a93)

### Example Code

https://github.com/octref/vscode-electron-debug

[Open an issue](https://github.com/octref/vscode-electron-debug/issues/new) if you have any question.